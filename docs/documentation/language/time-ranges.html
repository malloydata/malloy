---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/language/time-ranges.html
---

<div class="document">
      <h1>
        <a id="malloy-time-range-expressions" class="header-link anchor" href="#malloy-time-range-expressions">
          Malloy time range expressions
        </a>
      </h1>
    
      <h2>
        <a id="range-expressions" class="header-link anchor" href="#range-expressions">
          Range expressions
        </a>
      </h2>
    <p>There are two forms of range expressions</p>
<ul>
<li><p><em>expr</em> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">to</span></span></code> <em>expr</em> ( <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2001 to</span><span style="color: #000000"> </span><span style="color: #098658">@2003</span></span></code>)</p>
</li>
<li><p><em>expr</em> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">for</span></span></code> <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">N</span></span></code> <em>units</em> ( <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">now</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">15</span><span style="color: #000000"> </span><span style="color: #0000FF">minutes</span></span></code> )</p>
</li></ul>
<p>A timestamp can be compared to a range. If the time stamp is within
the range it will be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">=</span></span></code>. Before the range it will be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&lt;</span></span></code> and after
the range it will be <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">&gt;</span></span></code>. If you <a href="apply.html">apply</a> a range, (for example, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">eventDate</span><span style="color: #000000">: </span><span style="color: #098658">@2003 to</span><span style="color: #000000"> </span><span style="color: #098658">@2004</span></span></code>) that will also check if the value is within the range.</p>

      <h2>
        <a id="range-shortcuts" class="header-link anchor" href="#range-shortcuts">
          Range shortcuts
        </a>
      </h2>
    <p>Because grouping and filtering by specific time ranges is such a common operation for a data transformation task, Malloy has a number of expressive short cuts. The full power of the underlying SQL engine is also available for any type of truncation or extraction not supported by these shortcuts.</p>
<p>Malloy supports two time-related types, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">timestamp</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">date</span></span></code>.
Both of these can be used with these techniques, though the exact
truncations or extractions available will vary depending on the
data type (e.g. it would make no sense to attempt to truncate a <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #267F99">date</span></span></code> object by <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">minute</span></span></code>).</p>

      <h2>
        <a id="truncation" class="header-link anchor" href="#truncation">
          Truncation
        </a>
      </h2>
    <p>To create truncation, use the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">.</span></span></code> operator followed by the desired timeframe.</p>
<p>By way of example, if the value of <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span></span></code> is <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2021-08-06 00:36</span></span></code>, then the below truncations will produce the results on the right:</p>
<table>
<thead>
<tr>
<th>expression</th>

<th>result</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">minute</span></span></code></td>

<td>2021-08-06 00:36</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">hour</span></span></code></td>

<td>2021-08-06 00:00</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">day</span></span></code></td>

<td>2021-08-06</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">week</span></span></code></td>

<td>WK2021-08-01 <em>(the week containing the 10th)</em></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span></code></td>

<td>2021-08</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">quarter</span></span></code></td>

<td>Q2-2021</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code></td>

<td>2021</td>
</tr>
</tbody></table>

      <h3>
        <a id="truncations-as-ranges" class="header-link anchor" href="#truncations-as-ranges">
          Truncations as ranges
        </a>
      </h3>
    <p>A truncation made this way (unlike a truncation make in SQL with
<code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">TIMESTAMP_TRUNC</span><span style="color: #000000">()</span></span></code>) can also function as a range. The range begins
at the moment of truncation and the duration is the timeframe unit
used to specify the truncation, so for example <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">eventDate</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code>
would be a range covering the entire year which contains <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">eventDate</span></span></code></p>
<p>This is extremely useful with the <a href="apply.html">Apply operator</a>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">?</span></span></code>. To see if two events happen in the same calendar year, for example, the boolean expression in Malloy is <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">oneEvent</span><span style="color: #000000"> ? </span><span style="color: #001080">otherEvent</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span></code></p>

      <h2>
        <a id="extraction" class="header-link anchor" href="#extraction">
          Extraction
        </a>
      </h2>
    <p>Another very common grouping for time related data is by particular components, and this extraction of a single component as an integer. In Malloy this gesture looks like a function call.</p>
<p>The "Result" column uses a value of <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">2021</span><span style="color: #000000">-08-06 00:</span><span style="color: #098658">55</span><span style="color: #000000">:05</span></span></code> for <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">expr</span></span></code>.</p>
<table>
<thead>
<tr>
<th>expression</th>

<th>meaning</th>

<th>result</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">day_of_year</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>day of year, 1-365</td>

<td>218</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">day</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>day of month 1-31</td>

<td>5</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">day_of_week</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>day of week 1-7</td>

<td>6 <em>(Note: 1 represents Sunday)</em></td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">week</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>week in year, 1-53</td>

<td>31</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">quarter</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>quarter in year 1-4</td>

<td>3</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">hour</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>hour of day 0-23</td>

<td>0</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">minute</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>minute of hour 0-59</td>

<td>55</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">second</span><span style="color: #000000">(</span><span style="color: #001080">expr</span><span style="color: #000000">)</span></span></code></td>

<td>second of minute 0-59</td>

<td>5</td>
</tr>
</tbody></table>

      <h2>
        <a id="interval-extraction" class="header-link anchor" href="#interval-extraction">
          Interval extraction
        </a>
      </h2>
    <p>To measure the difference between two times, pass a range expression to
one of these extraction functions:</p>
<table>
<thead>
<tr>
<th>expression</th>

<th>meaning</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">seconds</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>Number of seconds from t1 until t2</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">minutes</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... minutes ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">hours</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... hours ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">days</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... days ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">weeks</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... weeks ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">months</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... months ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">quarters</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... quarters ...</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">years</span><span style="color: #000000">(</span><span style="color: #001080">t1</span><span style="color: #000000"> </span><span style="color: #0000FF">to</span><span style="color: #000000"> </span><span style="color: #001080">t2</span><span style="color: #000000">)</span></span></code></td>

<td>... years ...</td>
</tr>
</tbody></table>
<p>These will return a negative number if t1 is later than t2.</p>

      <h2>
        <a id="literals" class="header-link anchor" href="#literals">
          Literals
        </a>
      </h2>
    <p>Time literals are specified in malloy with the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@</span></span></code> character. A literal
specified this way has an implied duration which means a literal
can act like a range.</p>
<p>For example the year <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@2003</span></span></code> can be used with <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">eventTime</span><span style="color: #000000"> : </span><span style="color: #098658">@2003</span></span></code> to test if the
event happened in the year 2003.</p>
<table>
<thead>
<tr>
<th>Literal pattern</th>

<th>Duration</th>

<th>Begins</th>
</tr>
</thead>
<tbody><tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD</span></span></code></td>

<td>One year</td>

<td>The first day of that year</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-QN</span></span></code></td>

<td>Three months</td>

<td>The first day of that quarter</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM</span></span></code></td>

<td>One month</td>

<td>The first day of that month</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@WKDDDD-MM-SS</span></span></code></td>

<td>Seven days</td>

<td>Sunday of the week containing that day</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM-DD</span></span></code></td>

<td>One day</td>

<td>Midnight on the specified date</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM-DD HH:MM</span></span></code></td>

<td>One Minute</td>

<td>The specified time</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #098658">@DDDD-MM-DD HH:MM:SS</span></span></code></td>

<td>One Second</td>

<td>the specified time</td>
</tr>

<tr>
<td><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">now</span></span></code></td>

<td><em>N/A</em></td>

<td>The current time, without implied duration</td>
</tr>
</tbody></table>

      <h3>
        <a id="time-units" class="header-link anchor" href="#time-units">
          Time Units
        </a>
      </h3>
    <p>These are the time units currently supported by Malloy.</p>
<ul>
<li><p><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">second</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">minute</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">hour</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">week</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">month</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">quarter</span></span></code>, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">year</span></span></code></p>
</li></ul>
</div>