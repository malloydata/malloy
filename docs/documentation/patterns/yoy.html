---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/patterns/yoy.html
---

<div class="document">
      <h1>
        <a id="year-over-year-analysis" class="header-link anchor" href="#year-over-year-analysis">
          Year Over Year Analysis
        </a>
      </h1>
    <p>There are a couple of different ways to go about this in Malloy.</p>

      <h2>
        <a id="method-1-pivoting-a-visualization" class="header-link anchor" href="#method-1-pivoting-a-visualization">
          Method 1: Pivoting a Visualization
        </a>
      </h2>
    <p>Compare performance of different years on the same scale.  Line charts take the X-Axis, Y-Axis and Dimensional Axis as parameters.
In this Case, the X-Axis is <code class="language-malloy">month_of_year</code>, the Y-Axis is <code class="language-malloy">flight_count</code> and the Dimensional Axis is the year.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> {
  <span class="token keyword">measure</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}

<span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">nest</span>: year_over_year <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: month_of_year <span class="token keyword">is</span> <span class="token timeframe">month</span><span class="token punctuation">(</span>dep_time<span class="token punctuation">)</span>
    <span class="token keyword">aggregate</span>: flight_count
    <span class="token keyword">group_by</span>: flight_year <span class="token keyword">is</span> dep_time<span class="token punctuation">.</span><span class="token timeframe">year</span>
  }
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">year_&#8203;over_&#8203;year</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; "><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="marks" width="374" height="150" viewBox="0 0 374 150"><g fill="none" stroke-miterlimit="10" transform="translate(85,13)"><g class="mark-group role-frame root" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0.5,0.5h150v100h-150Z" stroke="#ddd"/><g><g class="mark-group role-axis" aria-hidden="true"><g transform="translate(0.5,100.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"/><g><g class="mark-rule role-axis-grid" pointer-events="none"><line transform="translate(14,-100)" x2="0" y2="100" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(41,-100)" x2="0" y2="100" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(68,-100)" x2="0" y2="100" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(95,-100)" x2="0" y2="100" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(123,-100)" x2="0" y2="100" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(150,-100)" x2="0" y2="100" stroke="#ddd" stroke-width="1" opacity="1"/></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"/></g></g><g class="mark-group role-axis" aria-hidden="true"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"/><g><g class="mark-rule role-axis-grid" pointer-events="none"><line transform="translate(0,100)" x2="150" y2="0" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(0,69)" x2="150" y2="0" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(0,38)" x2="150" y2="0" stroke="#ddd" stroke-width="1" opacity="1"/><line transform="translate(0,8)" x2="150" y2="0" stroke="#ddd" stroke-width="1" opacity="1"/></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"/></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="X-axis titled 'month_of_year' for a linear scale with values from 1 to 12"><g transform="translate(0.5,100.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"/><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(14,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(41,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(68,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(95,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(123,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(150,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"/></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="middle" transform="translate(13.636363636363637,15)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">2</text><text text-anchor="middle" transform="translate(40.90909090909091,15)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">4</text><text text-anchor="middle" transform="translate(68.18181818181817,15)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">6</text><text text-anchor="middle" transform="translate(95.45454545454545,15)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">8</text><text text-anchor="middle" transform="translate(122.72727272727273,15)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">10</text><text text-anchor="end" transform="translate(150,15)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">12</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="150" y2="0" stroke="#888" stroke-width="1" opacity="1"/></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(75,30)" font-family="Roboto" font-size="12px" font-weight="500" fill="#505050" opacity="1">month_of_year</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"/></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'flight_count' for a linear scale with values from 0 to 650,000"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"/><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,100)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(0,69)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(0,38)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"/><line transform="translate(0,8)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"/></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="end" transform="translate(-7,103)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="end" transform="translate(-7,72.23076923076923)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">200,000</text><text text-anchor="end" transform="translate(-7,41.46153846153846)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">400,000</text><text text-anchor="end" transform="translate(-7,10.692307692307686)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">600,000</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,100)" x2="0" y2="-100" stroke="#888" stroke-width="1" opacity="1"/></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(-67,50) rotate(-90) translate(0,-3)" font-family="Roboto" font-size="12px" font-weight="500" fill="#505050" opacity="1">flight_count</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"/></g></g><g class="mark-group role-scope pathgroup" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h150v100h-150Z"/><g><g class="mark-line role-mark marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="month_of_year: 1; flight_count: 594779; flight_year: Dec 31, 2004" role="graphics-symbol" aria-roledescription="line mark" d="M0,8.495538461538466L13.636363636363637,16.129384615384613L27.272727272727273,5.026461538461535L40.90909090909091,8.563538461538467L54.54545454545455,5.434153846153844L68.18181818181817,6.314615384615385L81.81818181818181,3.4501538461538472L95.45454545454545,2.989846153846154L109.0909090909091,11.659692307692303L122.72727272727273,8.823076923076922L136.36363636363635,12.920923076923074L150,11.965076923076923" stroke="rgb(18, 181, 203)" stroke-width="2"/></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h150v100h-150Z"/><g><g class="mark-line role-mark marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="month_of_year: 1; flight_count: 583886; flight_year: Dec 31, 2003" role="graphics-symbol" aria-roledescription="line mark" d="M0,10.171384615384616L13.636363636363637,14.80538461538462L27.272727272727273,7.48184615384615L40.90909090909091,10.32153846153846L54.54545454545455,8.564153846153843L68.18181818181817,9.456307692307696L81.81818181818181,5.538615384615387L95.45454545454545,4.153230769230765L109.0909090909091,9.99723076923077L122.72727272727273,6.161384615384613L136.36363636363635,10.092L150,6.68907692307692" stroke="rgb(0, 171, 212)" stroke-width="2"/></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h150v100h-150Z"/><g><g class="mark-line role-mark marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="month_of_year: 1; flight_count: 555138; flight_year: Dec 31, 2002" role="graphics-symbol" aria-roledescription="line mark" d="M0,14.594153846153846L13.636363636363637,22.560307692307692L27.272727272727273,13.955384615384613L40.90909090909091,18.889538461538457L54.54545454545455,17.901230769230768L68.18181818181817,17.482461538461536L81.81818181818181,14.098461538461537L95.45454545454545,14.33184615384615L109.0909090909091,18.82369230769231L122.72727272727273,15.028307692307695L136.36363636363635,18.75030769230769L150,14.555076923076927" stroke="rgb(0, 159, 222)" stroke-width="2"/></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h150v100h-150Z"/><g><g class="mark-line role-mark marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="month_of_year: 1; flight_count: 487158; flight_year: Dec 31, 2000" role="graphics-symbol" aria-roledescription="line mark" d="M0,25.052615384615386L13.636363636363637,32.420153846153845L27.272727272727273,23.49723076923077L40.90909090909091,20.90107692307692L54.54545454545455,18.477538461538458L68.18181818181817,19.976000000000006L81.81818181818181,17.170923076923074L95.45454545454545,16.264923076923075L109.0909090909091,24.521538461538462L122.72727272727273,31.729538461538464L136.36363636363635,35.79461538461538L150,33.872615384615386" stroke="rgb(0, 132, 233)" stroke-width="2"/></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h150v100h-150Z"/><g><g class="mark-line role-mark marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="month_of_year: 1; flight_count: 470407; flight_year: Dec 31, 1999" role="graphics-symbol" aria-roledescription="line mark" d="M0,27.62969230769231L13.636363636363637,31.62338461538462L27.272727272727273,25.711230769230763L40.90909090909091,28.738615384615386L54.54545454545455,26.333076923076927L68.18181818181817,27.53676923076923L81.81818181818181,25.64938461538462L95.45454545454545,24.415692307692304L109.0909090909091,28.762L122.72727272727273,25.277384615384612L136.36363636363635,28.12707692307692L150,26.00753846153846" stroke="rgb(26, 115, 232)" stroke-width="2"/></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h150v100h-150Z"/><g><g class="mark-line role-mark marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="month_of_year: 1; flight_count: 436304; flight_year: Dec 31, 2001" role="graphics-symbol" aria-roledescription="line mark" d="M0,32.87630769230769L13.636363636363637,38.53753846153845L27.272727272727273,31.09938461538462L40.90909090909091,32.60738461538462L54.54545454545455,30.766000000000005L68.18181818181817,31.035999999999998L81.81818181818181,28.92307692307692L95.45454545454545,28.196461538461538L109.0909090909091,33.85153846153847L122.72727272727273,31.299076923076917L136.36363636363635,36.153230769230774L150,34.29184615384615" stroke="rgb(0, 146, 229)" stroke-width="2"/></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g></g><g class="mark-group role-legend" role="graphics-symbol" aria-roledescription="legend" aria-label="Gradient legend titled 'flight_year' for stroke color with values from December 31, 1999 to December 31, 2004"><g transform="translate(170,0)"><path class="background" aria-hidden="true" d="M0,0h114v122h-114Z" pointer-events="none"/><g><g class="mark-group role-legend-entry"><g transform="translate(0,17)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"/><g><g class="mark-rect role-legend-gradient" pointer-events="none"><path d="M0,0h16v100h-16Z" fill="url(#gradient_9)" stroke="#ddd" stroke-width="0" opacity="1"/></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(18,102.98631636562672)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">Jan 01, 2000</text><text text-anchor="start" transform="translate(18,62.97536945812808)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">Jan 01, 2002</text><text text-anchor="start" transform="translate(18,23.019157088122608)" font-family="Roboto" font-size="10px" fill="#000" opacity="1">Jan 01, 2004</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"/></g></g><g class="mark-text role-legend-title" pointer-events="none"><text text-anchor="start" transform="translate(0,9)" font-family="Roboto" font-size="12px" font-weight="500" fill="#505050" opacity="1">flight_year</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"/></g></g></g><path class="foreground" aria-hidden="true" d="" display="none"/></g></g></g><defs><linearGradient id="gradient_9" x1="0" x2="0" y1="1" y2="0"><stop offset="0" stop-color="rgb(26, 115, 232)"/><stop offset="0.00013683634373289546" stop-color="rgb(26, 115, 232)"/><stop offset="0.04994526546250684" stop-color="rgb(0, 119, 233)"/><stop offset="0.09973088852399198" stop-color="rgb(0, 124, 233)"/><stop offset="0.1500866630176975" stop-color="rgb(0, 128, 233)"/><stop offset="0.20046524356869183" stop-color="rgb(0, 132, 233)"/><stop offset="0.24972632731253422" stop-color="rgb(0, 136, 233)"/><stop offset="0.29951195037401934" stop-color="rgb(0, 139, 232)"/><stop offset="0.3498677248677249" stop-color="rgb(0, 143, 231)"/><stop offset="0.4002463054187192" stop-color="rgb(0, 146, 229)"/><stop offset="0.44950738916256155" stop-color="rgb(0, 150, 228)"/><stop offset="0.4992930122240467" stop-color="rgb(0, 153, 226)"/><stop offset="0.5496487867177522" stop-color="rgb(0, 156, 224)"/><stop offset="0.6000273672687466" stop-color="rgb(0, 159, 222)"/><stop offset="0.6492884510125889" stop-color="rgb(0, 162, 220)"/><stop offset="0.6990740740740741" stop-color="rgb(0, 165, 217)"/><stop offset="0.7494298485677796" stop-color="rgb(0, 168, 215)"/><stop offset="0.7998084291187739" stop-color="rgb(0, 171, 212)"/><stop offset="0.8496168582375478" stop-color="rgb(0, 173, 210)"/><stop offset="0.899402481299033" stop-color="rgb(0, 176, 208)"/><stop offset="0.9497582557927385" stop-color="rgb(0, 179, 205)"/><stop offset="1" stop-color="rgb(18, 181, 203)"/></linearGradient></defs></svg></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"year_over_year"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">630566</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">627574</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">623004</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">617328</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">614678</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">613999</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">609951</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">608955</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">606521</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">601368</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">594779</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">594337</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">594333</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">592650</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">588534</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">585018</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">584402</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">583886</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">582910</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">574212</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">572227</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">566014</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">559290</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">558360</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">556843</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">555392</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">555138</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">553765</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">552316</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">545159</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">544278</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">538389</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">536364</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">533642</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">529896</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">528123</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">527646</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">527218</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">520156</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">514143</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">503358</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2003-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">497268</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">491298</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">490610</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">487158</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">485697</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">483279</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">482877</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">480951</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">478835</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">471011</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">470407</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">467174</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">466723</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">463199</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">463047</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">462000</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">450021</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">448266</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">447854</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">446556</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">444448</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2000-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">443758</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">439269</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">438052</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">436304</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">429965</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">429828</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">427103</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">417335</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2001-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">415004</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"month_of_year"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">399506</span><span class="token punctuation">,</span>
        <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2002-01-01"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">MONTH</span> <span class="token keyword">FROM</span> flights<span class="token punctuation">.</span>dep_time<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> month_of_year__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_year__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>month_of_year__1 <span class="token keyword">as</span> month_of_year<span class="token punctuation">,</span> flight_count__1 <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span> flight_year__1 <span class="token keyword">as</span> flight_year<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  flight_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> year_over_year
<span class="token keyword">FROM</span> __stage0
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="method-2-filtered-aggregates" class="header-link anchor" href="#method-2-filtered-aggregates">
          Method 2: Filtered Aggregates
        </a>
      </h2>
    <p>Filters make it easy to reuse aggregate calculations for trends analysis.</p>
<pre class="language-malloy"><span class="token comment">// common calculation for flights</span>
<span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> {
  <span class="token keyword">measure</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}

<span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: carrier
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    flights_in_2002 <span class="token keyword">is</span> flight_count { <span class="token keyword">where</span>: dep_time <span class="token operator">=</span> <span class="token date">@2002</span> }
    flights_in_2003 <span class="token keyword">is</span> flight_count { <span class="token keyword">where</span>: dep_time <span class="token operator">=</span> <span class="token date">@2003</span> }
    percent_change <span class="token keyword">is</span> <span class="token function">round</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>flight_count { <span class="token keyword">where</span>: dep_time <span class="token operator">=</span> <span class="token date">@2003</span> } <span class="token operator">-</span> flight_count { <span class="token keyword">where</span>: dep_time <span class="token operator">=</span> <span class="token date">@2002</span> }<span class="token punctuation">)</span>
        <span class="token operator">/</span> <span class="token function">nullif</span><span class="token punctuation">(</span>flight_count { <span class="token keyword">where</span>: dep_time <span class="token operator">=</span> <span class="token date">@2003</span> }<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flights_&#8203;in_&#8203;2002</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flights_&#8203;in_&#8203;2003</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">percent_&#8203;change</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">955,785</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">958,552</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">851,499</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">752,197</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-13.2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">728,659</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">660,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-10.3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">587,848</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">543,930</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-8.1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NW</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">513,325</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">499,153</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-2.8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">US</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,106</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">411,942</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-24.1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MQ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">439,056</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">429,092</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-2.3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">325,014</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">302,741</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-7.4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HP</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">195,870</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">189,325</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-3.5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">159,192</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">161,592</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">F9</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;"></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">403,014</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OH</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;"></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">B6</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">67,151</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">144,675</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TW</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;"></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AQ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;"></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">EV</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">273,071</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">69,159</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DH</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">291,581</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">RU</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">328,086</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,831</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">100</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"WN"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">955785</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">958552</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">0.3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AA"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">851499</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">752197</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-13.2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"DL"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">728659</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">660598</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-10.3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"UA"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">587848</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">543930</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-8.1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"NW"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">513325</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">499153</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-2.8</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"US"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">511106</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">411942</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-24.1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"MQ"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">439056</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">429092</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-2.3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"CO"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">325014</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">302741</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-7.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"HP"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">195870</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">189325</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-3.5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AS"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">159192</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">161592</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">1.5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"F9"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"OO"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">403014</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"OH"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"B6"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">67151</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"FL"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">144675</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"TW"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AQ"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"EV"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">273071</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"TZ"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">69159</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"DH"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">291581</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"RU"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">328086</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"HA"</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2002"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"flights_in_2003"</span><span class="token operator">:</span> <span class="token number">7831</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   flights<span class="token punctuation">.</span>carrier <span class="token keyword">as</span> carrier<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2002-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flights_in_2002<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2004-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flights_in_2003<span class="token punctuation">,</span>
   <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2004-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2002-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">nullif</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2004-01-01'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> percent_change
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="using-relative-timeframes" class="header-link anchor" href="#using-relative-timeframes">
          Using Relative Timeframes
        </a>
      </h3>
    <p>Often you want to show up-to-date information.  You can write timeframes relatively so the queries always show
current data.  Read more about it in the <a href="filter_expressions.html">filters</a> section.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: inventory_items <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.inventory_items'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: id
}

<span class="token keyword">explore</span>: order_items <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.order_items'</span><span class="token punctuation">)</span> {
  <span class="token keyword">join_one</span>: inventory_items <span class="token keyword">with</span> inventory_item_id
  <span class="token keyword">measure</span>: order_item_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}

<span class="token keyword">query</span>: order_items <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">top</span>: <span class="token number">10</span>
  <span class="token keyword">group_by</span>: inventory_items<span class="token punctuation">.</span>product_category
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    last_year <span class="token keyword">is</span> order_item_count { <span class="token keyword">where</span>: created_at: now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token timeframe">year</span> }
    prior_year <span class="token keyword">is</span> order_item_count { <span class="token keyword">where</span>: created_at: now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token timeframe">years</span> }
    percent_change <span class="token keyword">is</span> <span class="token function">round</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>order_item_count { <span class="token keyword">where</span>: created_at: now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token timeframe">year</span> } <span class="token operator">-</span> order_item_count { <span class="token keyword">where</span>: created_at: now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token timeframe">years</span> }<span class="token punctuation">)</span>
        <span class="token operator">/</span> <span class="token function">nullif</span><span class="token punctuation">(</span>order_item_count { <span class="token keyword">where</span>: created_at : now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token timeframe">years</span> }<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">product_&#8203;category</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">last_&#8203;year</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">prior_&#8203;year</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">percent_&#8203;change</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Accessories</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,730</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10,295</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-24.9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jeans</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,407</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9,796</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-24.4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Tops & Tees</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6,497</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8,475</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-23.3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Active</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,452</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,178</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-24</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Shorts</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,844</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6,322</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-23.4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Pants</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,711</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-23.6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Outerwear & Coats</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,992</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,022</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-25.6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Fashion Hoodies & Sweatshirts</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,889</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,979</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-27.4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Dresses</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,880</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,889</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-25.9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sweaters</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,564</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,482</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-26.4</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Accessories"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">7730</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">10295</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-24.9</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Jeans"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">7407</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">9796</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-24.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Tops &amp; Tees"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">6497</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">8475</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-23.3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Active"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">5452</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">7178</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-24</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Shorts"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">4844</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">6322</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-23.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Pants"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">3598</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">4711</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-23.6</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Outerwear &amp; Coats"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2992</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">4022</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-25.6</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Fashion Hoodies &amp; Sweatshirts"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2889</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">3979</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-27.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Dresses"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2880</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">3889</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-25.9</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Sweaters"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2564</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">3482</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-26.4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   inventory_items_0<span class="token punctuation">.</span>product_category <span class="token keyword">as</span> product_category<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> last_year<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> prior_year<span class="token punctuation">,</span>
   <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">nullif</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> percent_change
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>ecomm<span class="token punctuation">.</span>order_items<span class="token punctuation">`</span> <span class="token keyword">as</span> order_items
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>ecomm<span class="token punctuation">.</span>inventory_items<span class="token punctuation">`</span> <span class="token keyword">AS</span> inventory_items_0 <span class="token keyword">ON</span> order_items<span class="token punctuation">.</span>inventory_item_id <span class="token operator">=</span> inventory_items_0<span class="token punctuation">.</span>id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">10</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="declaring-and-reusing-common-expressions" class="header-link anchor" href="#declaring-and-reusing-common-expressions">
          Declaring and reusing common expressions
        </a>
      </h3>
    <p>We can rewrite the query so it is more reusable.  The declarations after the explore are temporary additions to this order_items table for the sake of just this query.</p>
<pre class="language-malloy"><span class="token comment">-- common calculation for order_items</span>
<span class="token keyword">explore</span>: inventory_items <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.inventory_items'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: id
}

<span class="token keyword">explore</span>: order_items <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.order_items'</span><span class="token punctuation">)</span> {
  <span class="token keyword">join_one</span>: inventory_items  <span class="token keyword">with</span> inventory_item_id
  <span class="token keyword">measure</span>: order_item_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}

<span class="token keyword">query</span>: order_items{
  <span class="token keyword">measure</span>: <span class="token punctuation">[</span>
    <span class="token comment">// these caclulations can be used in multipe parts of the query</span>
    last_year <span class="token keyword">is</span> order_item_count { <span class="token keyword">where</span>: created_at: now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token timeframe">year</span> }
    prior_year <span class="token keyword">is</span> order_item_count { <span class="token keyword">where</span>: created_at: now<span class="token punctuation">.</span><span class="token timeframe">year</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token timeframe">years</span> }
  <span class="token punctuation">]</span>
} <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">top</span>: <span class="token number">10</span>
  <span class="token keyword">group_by</span>: inventory_items<span class="token punctuation">.</span>product_category
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    last_year
    prior_year
    percent_change <span class="token keyword">is</span> <span class="token function">round</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>last_year <span class="token operator">-</span> prior_year<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">nullif</span><span class="token punctuation">(</span>last_year<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token number">1</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">product_&#8203;category</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">last_&#8203;year</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">prior_&#8203;year</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">percent_&#8203;change</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Accessories</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,730</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10,295</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-33.2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jeans</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,407</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9,796</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-32.3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Tops & Tees</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6,497</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8,475</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-30.4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Active</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,452</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7,178</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-31.7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Shorts</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,844</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6,322</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-30.5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Pants</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,711</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-30.9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Outerwear & Coats</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,992</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,022</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-34.4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Fashion Hoodies & Sweatshirts</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,889</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,979</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-37.7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Dresses</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,880</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,889</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-35</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sweaters</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,564</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,482</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">-35.8</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Accessories"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">7730</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">10295</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-33.2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Jeans"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">7407</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">9796</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-32.3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Tops &amp; Tees"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">6497</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">8475</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-30.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Active"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">5452</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">7178</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-31.7</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Shorts"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">4844</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">6322</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-30.5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Pants"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">3598</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">4711</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-30.9</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Outerwear &amp; Coats"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2992</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">4022</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-34.4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Fashion Hoodies &amp; Sweatshirts"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2889</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">3979</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-37.7</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Dresses"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2880</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">3889</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-35</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"product_category"</span><span class="token operator">:</span> <span class="token string">"Sweaters"</span><span class="token punctuation">,</span>
    <span class="token property">"last_year"</span><span class="token operator">:</span> <span class="token number">2564</span><span class="token punctuation">,</span>
    <span class="token property">"prior_year"</span><span class="token operator">:</span> <span class="token number">3482</span><span class="token punctuation">,</span>
    <span class="token property">"percent_change"</span><span class="token operator">:</span> <span class="token number">-35.8</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   inventory_items_0<span class="token punctuation">.</span>product_category <span class="token keyword">as</span> product_category<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> last_year<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> prior_year<span class="token punctuation">,</span>
   <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">2</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">nullif</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">>=</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>order_items<span class="token punctuation">.</span>created_at<span class="token operator">&lt;</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_ADD<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span>DATETIME_SUB<span class="token punctuation">(</span><span class="token keyword">DATETIME</span><span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> percent_change
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>ecomm<span class="token punctuation">.</span>order_items<span class="token punctuation">`</span> <span class="token keyword">as</span> order_items
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>ecomm<span class="token punctuation">.</span>inventory_items<span class="token punctuation">`</span> <span class="token keyword">AS</span> inventory_items_0 <span class="token keyword">ON</span> order_items<span class="token punctuation">.</span>inventory_item_id <span class="token operator">=</span> inventory_items_0<span class="token punctuation">.</span>id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">10</span>
</pre>
      </div>
    </div>
  </div></div>